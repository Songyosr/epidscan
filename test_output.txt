ℹ Testing epidscan
✔ | F W  S  OK | Context

⠏ |          0 | epid_satscan                                                   
⠙ |          2 | epid_satscan                                                   
✔ |          4 | epid_satscan

⠏ |          0 | satscan_data_prep                                              
✖ | 1        7 | satscan_data_prep
────────────────────────────────────────────────────────────────────────────────
Error ('test-satscan_data_prep.R:62:5'): write_satscan_files creates correct files
Error in `data.frame(id = export_df$id, cases = export_df$cases)`: arguments imply differing number of rows: 2, 0
Backtrace:
    ▆
 1. └─epidscan:::write_satscan_files(geo_df, export_df, temp_dir, project_name) at test-satscan_data_prep.R:62:5
 2.   └─base::data.frame(id = export_df$id, cases = export_df$cases) at epidscan/R/satscan_data_prep.R:65:5
────────────────────────────────────────────────────────────────────────────────

⠏ |          0 | satscan_options                                                
✖ | 1        7 | satscan_options
────────────────────────────────────────────────────────────────────────────────
Error ('test-satscan_options.R:26:5'): build_satscan_options merges parameters correctly
Error in `build_satscan_options(list(CaseFile = "case.cas"), analysis_type = "space-time", model_type = "poisson", time_precision = 3)`: unused arguments (analysis_type = "space-time", model_type = "poisson")
────────────────────────────────────────────────────────────────────────────────

⠏ |          0 | satscan_results                                                
⠸ | 2        2 | satscan_results                                                
✖ | 2        2 | satscan_results
────────────────────────────────────────────────────────────────────────────────
Failure ('test-satscan_results.R:12:5'): parse_results handles empty results gracefully
Expected `"CLUSTER" %in% names(result)` to be TRUE.
Differences:
`actual`:   FALSE
`expected`: TRUE 


Error ('test-satscan_results.R:32:5'): parse_results joins cluster info correctly
<vctrs_error_subscript_oob/vctrs_error_subscript/rlang_error/error/condition>
Error in `dplyr::select(ss_results$gis, CLUSTER, P_VALUE, REL_RISK = CLU_RR)`: Can't select columns that don't exist.
✖ Column `CLU_RR` doesn't exist.
Backtrace:
     ▆
  1. ├─epidscan:::parse_results(mock_ss, data, rlang::quo(id)) at test-satscan_results.R:32:5
  2. │ ├─dplyr::distinct(...) at epidscan/R/satscan_results.R:106:5
  3. │ ├─dplyr::select(ss_results$gis, CLUSTER, P_VALUE, REL_RISK = CLU_RR) at epidscan/R/satscan_results.R:106:5
  4. │ └─dplyr:::select.data.frame(ss_results$gis, CLUSTER, P_VALUE, REL_RISK = CLU_RR)
  5. │   └─tidyselect::eval_select(expr(c(...)), data = .data, error_call = error_call)
  6. │     └─tidyselect:::eval_select_impl(...)
  7. │       ├─tidyselect:::with_subscript_errors(...)
  8. │       │ └─base::withCallingHandlers(...)
  9. │       └─tidyselect:::vars_select_eval(...)
 10. │         └─tidyselect:::walk_data_tree(expr, data_mask, context_mask)
 11. │           └─tidyselect:::eval_c(expr, data_mask, context_mask)
 12. │             └─tidyselect:::reduce_sels(node, data_mask, context_mask, init = init)
 13. │               └─tidyselect:::walk_data_tree(new, data_mask, context_mask)
 14. │                 └─tidyselect:::as_indices_sel_impl(...)
 15. │                   └─tidyselect:::as_indices_impl(...)
 16. │                     └─tidyselect:::chr_as_locations(x, vars, call = call, arg = arg)
 17. │                       └─vctrs::vec_as_location(...)
 18. └─vctrs (local) `<fn>`()
 19.   └─vctrs:::stop_subscript_oob(...)
 20.     └─vctrs:::stop_subscript(...)
 21.       └─rlang::abort(...)
────────────────────────────────────────────────────────────────────────────────

⠏ |          0 | utils_config                                                   
✔ |   1      4 | utils_config
────────────────────────────────────────────────────────────────────────────────
Warning ('test-utils_config.R:6:5'): set_satscan_path sets option
Path does not exist: /tmp/fake/satscan
Backtrace:
    ▆
 1. ├─testthat::expect_message(set_satscan_path(mock_path), "SatScan path set to") at test-utils_config.R:6:5
 2. │ └─testthat:::quasi_capture(enquo(object), label, capture_messages)
 3. │   ├─testthat (local) .capture(...)
 4. │   │ └─base::withCallingHandlers(...)
 5. │   └─rlang::eval_bare(quo_get_expr(.quo), quo_get_env(.quo))
 6. └─epidscan::set_satscan_path(mock_path)
────────────────────────────────────────────────────────────────────────────────

⠏ |          0 | workflow-lepto                                                 
⠋ |      1   0 | workflow-lepto                                                 
✔ |      1   0 | workflow-lepto

══ Results ═════════════════════════════════════════════════════════════════════
── Skipped tests (1) ───────────────────────────────────────────────────────────
• Shapefile not found (1): 'test-workflow-lepto.R:30:9'

── Failed tests ────────────────────────────────────────────────────────────────
Error ('test-satscan_data_prep.R:62:5'): write_satscan_files creates correct files
Error in `data.frame(id = export_df$id, cases = export_df$cases)`: arguments imply differing number of rows: 2, 0
Backtrace:
    ▆
 1. └─epidscan:::write_satscan_files(geo_df, export_df, temp_dir, project_name) at test-satscan_data_prep.R:62:5
 2.   └─base::data.frame(id = export_df$id, cases = export_df$cases) at epidscan/R/satscan_data_prep.R:65:5

Error ('test-satscan_options.R:26:5'): build_satscan_options merges parameters correctly
Error in `build_satscan_options(list(CaseFile = "case.cas"), analysis_type = "space-time", model_type = "poisson", time_precision = 3)`: unused arguments (analysis_type = "space-time", model_type = "poisson")

Failure ('test-satscan_results.R:12:5'): parse_results handles empty results gracefully
Expected `"CLUSTER" %in% names(result)` to be TRUE.
Differences:
`actual`:   FALSE
`expected`: TRUE 


Error ('test-satscan_results.R:32:5'): parse_results joins cluster info correctly
<vctrs_error_subscript_oob/vctrs_error_subscript/rlang_error/error/condition>
Error in `dplyr::select(ss_results$gis, CLUSTER, P_VALUE, REL_RISK = CLU_RR)`: Can't select columns that don't exist.
✖ Column `CLU_RR` doesn't exist.
Backtrace:
     ▆
  1. ├─epidscan:::parse_results(mock_ss, data, rlang::quo(id)) at test-satscan_results.R:32:5
  2. │ ├─dplyr::distinct(...) at epidscan/R/satscan_results.R:106:5
  3. │ ├─dplyr::select(ss_results$gis, CLUSTER, P_VALUE, REL_RISK = CLU_RR) at epidscan/R/satscan_results.R:106:5
  4. │ └─dplyr:::select.data.frame(ss_results$gis, CLUSTER, P_VALUE, REL_RISK = CLU_RR)
  5. │   └─tidyselect::eval_select(expr(c(...)), data = .data, error_call = error_call)
  6. │     └─tidyselect:::eval_select_impl(...)
  7. │       ├─tidyselect:::with_subscript_errors(...)
  8. │       │ └─base::withCallingHandlers(...)
  9. │       └─tidyselect:::vars_select_eval(...)
 10. │         └─tidyselect:::walk_data_tree(expr, data_mask, context_mask)
 11. │           └─tidyselect:::eval_c(expr, data_mask, context_mask)
 12. │             └─tidyselect:::reduce_sels(node, data_mask, context_mask, init = init)
 13. │               └─tidyselect:::walk_data_tree(new, data_mask, context_mask)
 14. │                 └─tidyselect:::as_indices_sel_impl(...)
 15. │                   └─tidyselect:::as_indices_impl(...)
 16. │                     └─tidyselect:::chr_as_locations(x, vars, call = call, arg = arg)
 17. │                       └─vctrs::vec_as_location(...)
 18. └─vctrs (local) `<fn>`()
 19.   └─vctrs:::stop_subscript_oob(...)
 20.     └─vctrs:::stop_subscript(...)
 21.       └─rlang::abort(...)

[ FAIL 4 | WARN 1 | SKIP 1 | PASS 24 ]
