% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/satscanr.R
\name{satscanr}
\alias{satscanr}
\title{Run SaTScan Analysis}
\usage{
satscanr(
  cas,
  pop = NULL,
  geo,
  ctl = NULL,
  grd = NULL,
  prm_path = NULL,
  output_dir = NULL,
  verbose = FALSE,
  ...
)
}
\arguments{
\item{cas}{Case table (\code{satscan_table} of kind "cas") or \code{ss_tbl} of type "cas".}

\item{pop}{Population table (\code{satscan_table} of kind "pop", optional).
Required for Poisson model. Created via \code{\link{prep_pop}}.}

\item{geo}{Geometry table (\code{satscan_table} of kind "geo"). Created via \code{\link{prep_geo}}.}

\item{ctl}{Control table (\code{satscan_table} of kind "ctl", optional).
Required for Bernoulli model. Created via \code{\link{prep_ctl}}.}

\item{grd}{Grid table (\code{satscan_table} of kind "grd", optional).
Custom scan centers. Created via \code{\link{prep_grd}}.}

\item{prm_path}{Path to a template \code{.prm} file to load configuration from (Level 3).
If NULL, uses bundled defaults.}

\item{output_dir}{Directory to copy final results to. If NULL, results remain in temp.}

\item{verbose}{Logical. Print progress and debug info.}

\item{...}{Additional SaTScan parameters (Level 2 Tweaks).
See \code{\link{satscan_parameters}} for a full list. Common parameters include:
\itemize{
\item \code{AnalysisType}: 1=Purely Spatial, 2=Purely Temporal, 3=Retrospective Space-Time,
4=Prospective Space-Time, 5=Spatial Variation in Temporal Trends
\item \code{ModelType}: 0=Discrete Poisson, 1=Bernoulli, 2=Space-Time Permutation
\item \code{ScanAreas}: 1=High Rates, 2=Low Rates, 3=Both
\item \code{MonteCarloReps}: Number of Monte Carlo replications (e.g., 999, 9999)
}}
}
\value{
A \code{satscan_result} object containing:
\itemize{
\item \code{cluster_summary}: Data frame of detected clusters with p-values and relative risks
\item \code{location_summary}: Data frame of all locations with cluster assignments
\item \code{main_results}: Full time-series data merged with results (if \code{merge_time_series=TRUE})
\item \code{raw_output}: Raw SaTScan output (col, gis, rr, shapefile, etc.)
\item \code{prm}: Final \code{prm_list} object with all parameters used
\item \code{work_dir}: Path to output directory
}
}
\description{
Runs a SaTScan session end-to-end: writes required SaTScan ASCII inputs
(\code{.cas}, \code{.geo}, and optionally \code{.pop}/\code{.ctl}/\code{.grd}),
builds a final \code{.prm} configuration using a strict precedence hierarchy,
executes the SaTScan command-line program, and parses outputs into an R result object.
}
\details{
\strong{What SaTScan does (short):}
SaTScan detects and evaluates clusters by scanning many candidate windows across space,
time, or space-time. For each candidate window, it computes a \emph{probability-model-specific}
likelihood ratio (or analogous test statistic) comparing the risk \emph{inside} the window
versus \emph{outside}. The window with the maximum statistic is reported as the
\strong{most likely cluster}. Statistical significance is typically assessed by Monte Carlo
simulation under the null, repeating the same scan to obtain the null distribution of the
maximum statistic.

\strong{Probability models:}
The likelihood/test statistic depends on \code{ModelType} (e.g., discrete Poisson, Bernoulli,
space-time permutation, multinomial, ordinal, exponential, normal). This function delegates
all inferential details to the SaTScan executable; this documentation only summarizes the
general workflow.

\strong{Example (discrete Poisson; high-rate scanning):}
Let \eqn{C} be total cases, \eqn{c} observed cases inside a window, and \eqn{E} the expected
cases inside that window under the null (possibly covariate-adjusted). A commonly reported
likelihood ratio form is proportional to:
\deqn{
\Lambda
=
\left(\frac{c}{E}\right)^{c}
\left(\frac{C-c}{C-E}\right)^{C-c}
\cdot \mathbb{I}(c > E)
}
where \eqn{\mathbb{I}(c > E)} enforces the “high-rate” constraint. (For low-rate or two-sided
scanning, the indicator rule differs; see the SaTScan User Guide.)

\strong{Example (Bernoulli; high-rate scanning):}
Let \eqn{C} be total cases, \eqn{c} cases inside the window, \eqn{N} total observations
(cases + controls), and \eqn{n} observations inside the window. SaTScan uses an analogous
likelihood ratio based on the in-window vs out-of-window case proportions.

\strong{User guide:}
For full details on model-specific likelihoods, scanning windows, and parameter definitions,
see the SaTScan technical documentation (includes the User Guide PDF):
\url{https://www.satscan.org/techdoc.html}
}
\examples{
\dontrun{
# Basic Poisson analysis
cas <- prep_cas(cases_df, loc_id = id, time = date, cases = n, time_precision = "day")
geo <- prep_geo(locations_sf, loc_id = id)
pop <- prep_pop(pop_df, loc_id = id, time = year, pop = population)

result <- satscanr(cas, pop = pop, geo = geo, verbose = TRUE)

# View clusters
print(result)
summary(result)

# With custom parameters (Level 2 tweaks)
result2 <- satscanr(cas,
    pop = pop, geo = geo,
    AnalysisType = 3,
    MonteCarloReps = 9999,
    MaxTemporalSize = 50
)

# Using a template PRM file (Level 3)
result3 <- satscanr(cas,
    pop = pop, geo = geo,
    prm_path = "my_template.prm",
    verbose = TRUE
)
}

}
\references{
Kulldorff M. (1997). A spatial scan statistic.
Communications in Statistics: Theory and Methods, 26:1481-1496.

Kulldorff M. (2022). SaTScan User Guide for version 10.1.
\url{https://www.satscan.org/}
}
\seealso{
\code{\link{prep_cas}}, \code{\link{prep_geo}}, \code{\link{prep_pop}} for input preparation.
\code{\link{satscan_parameters}} for parameter reference.
\code{\link{prm_parse}}, \code{\link{prm_set}} for advanced parameter manipulation.
}
