# epidscan

**A Modern R Interface for Spatio-Temporal Scan Statistics.**

`epidscan` brings modern data science workflows to epidemiological
cluster detection. Currently powering
[SaTScan™](https://www.satscan.org/), it is designed to be a flexible,
type-safe, and stateless interface for spatial and space-time analysis.

## Design Principles

- **Stateless**: No global side-effects.
- **Type-Safe**: `ss_tbl` classes ensure your data is analysis-ready
  before you run a single line of code.
- **Spatial-Native**: Built-in support for `sf` simple features.

## Installation

``` r

# Install from GitHub
pak::pak("Songyosr/epidscan")
```

**Requirements:** [SaTScan™](https://www.satscan.org/) must be installed
on your system.

## Quick Start

Here is a complete space-time analysis of the New Mexico lung cancer
dataset (included in the package).

``` r

library(epidscan)
library(dplyr)
#> 
#> Attaching package: 'dplyr'
#> The following objects are masked from 'package:stats':
#> 
#>     filter, lag
#> The following objects are masked from 'package:base':
#> 
#>     intersect, setdiff, setequal, union
library(broom)

# 1. Prepare Data
# Load included datasets
data("NMlung_cas", "NMlung_pop", "NMlung_geo")

# Create validated inputs
cas <- ss_cas(NMlung_cas, loc_id = "county", cases = "cases", time = "date", time_precision = "month", covars = c("age_group", "sex"))
pop <- ss_pop(NMlung_pop, loc_id = "county", population = "population", time = "year", time_precision = "year", covars = c("age_group", "sex"))
geo <- ss_geo(NMlung_geo, loc_id = "county", coord1 = "x_km", coord2 = "y_km", coord_type = "cartesian")

# 2. Run Analysis
# Set path to SaTScan (adjust for your system)
# Note: This path is specific to macOS; adjust for Windows/Linux
# set_satscan_path("/Applications/SaTScan.app/Contents/app/satscan")
set_satscan_path("/Applications/SaTScan.app/Contents/app/satscan")
#> SatScan path set to: /Applications/SaTScan.app/Contents/app/satscan

# Configure with prm_options (Object-Oriented Parameter Management)
# This creates a reproducible parameter object that can be inspected and reused.
my_prm <- prm_options(
  AnalysisType = 3, # Retrospective Space-Time
  ModelType = 0, # Poisson
  MonteCarloReps = 999
)

# Run the analysis
result <- satscanr(
  cas, pop, geo,
  prm = my_prm,
  verbose = FALSE
)

# 3. Explore Results
# Tidy summary of detected clusters
summary(result)
#> SaTScan Results Summary
#> =======================
#> 
#> ── SaTScan Analysis Summary ──────────────────────────────────
#> Model: Discrete Poisson [High Rates]
#> Scan:  Retrospective Space-Time
#> Time:  1973/01/01 to 1991/12/31 (Month)
#> Space: Circular (Max: 50% pop)
#> Sims:  999 Monte Carlo Reps
#> ──────────────────────────────────────────────────────────────
#> 
#> Overview:
#>   Clusters detected:  6 (2 significant at p < 0.05)
#>   Locations analyzed: 37 (17 in clusters)
#>   Relative risk:      0.30 - 1.36
#> 
#> Most Likely Cluster:
#>   Cluster ID:         1
#>   P-value:            0.000000
#>   Observed:           714
#>   Expected:           502.0
#> 
#> Cluster Statistics:
#>   statistic        min        q1 median       mean        q3     max
#> 1   p_value 6.7257e-13 0.2020006  0.866  0.6128335   0.94275   0.996
#> 2 radius_km 0.0000e+00 0.0000000 58.860 64.3225655 121.00681 146.113
#> 
#> 
#> (Raw SaTScan text available. Use print(result, raw = TRUE) to view)

# Analysis-level metrics
tidy(result)
#> # A tibble: 6 × 13
#>   cluster center_id     x     y  p_value   llr observed expected obs_exp_ratio
#>     <int> <chr>     <dbl> <dbl>    <dbl> <dbl>    <dbl>    <dbl>         <dbl>
#> 1       1 Chaves      418   156 6.73e-13 42.1       714   502.            1.42
#> 2       2 Socorro     199   222 7.71e- 7 25.7      2474  2177.            1.14
#> 3       3 Lea         528   103 8.08e- 1  8.60       10     1.88          5.32
#> 4       4 Chaves      418   156 9.24e- 1  8.11      467   387.            1.21
#> 5       5 Sierra      166   127 9.49e- 1  7.91       10     2.05          4.88
#> 6       6 SanJuan      96   531 9.96e- 1  6.88       10     2.34          4.28
#> # ℹ 4 more variables: radius_km <dbl>, population <dbl>, start_date <date>,
#> #   end_date <date>

# Visualization
# map_clusters(result, simple = TRUE) # Interactive map (view locally)
```

For a detailed walkthrough, implementation details, and advanced
configuration, see the [Getting Started
vignette](https://Songyosr.github.io/epidscan/vignettes/getting-started.Rmd).

## Available Input Types

| Function | File Type | Purpose | status |
|----|----|----|:--:|
| [`ss_cas()`](https://Songyosr.github.io/epidscan/reference/ss_cas.md) | `.cas` | Case counts | ✓ |
| [`ss_pop()`](https://Songyosr.github.io/epidscan/reference/ss_pop.md) | `.pop` | Population denominators | ✓ |
| [`ss_geo()`](https://Songyosr.github.io/epidscan/reference/ss_geo.md) | `.geo` | Spatial coordinates | ✓ |
| [`ss_ctl()`](https://Songyosr.github.io/epidscan/reference/ss_ctl.md) | `.ctl` | Controls (Bernoulli) | ✓ |
| [`ss_grd()`](https://Songyosr.github.io/epidscan/reference/ss_grd.md) | `.grd` | Custom scan centers | ✓ |
| [`ss_nwk()`](https://Songyosr.github.io/epidscan/reference/ss_nwk.md) | `.nwk` | Network edges | Under Dev |
| [`ss_nbr()`](https://Songyosr.github.io/epidscan/reference/ss_nbr.md) | `.nbr` | Neighbor rankings | Under Dev |
| [`ss_met()`](https://Songyosr.github.io/epidscan/reference/ss_met.md) | `.met` | Meta-locations | Under Dev |

## Documentation

- [Getting
  Started](https://Songyosr.github.io/epidscan/doc/getting-started.md)
- [Parameter
  Reference](https://Songyosr.github.io/epidscan/doc/satscan-parameters.md)
- [Report Issues](https://github.com/Songyosr/epidscan/issues)

## Citation

Please cite the original SaTScan software and methodology:

> Kulldorff M. (1997). A spatial scan statistic. Communications in
> Statistics: Theory and Methods, 26:1481-1496.

> Kulldorff M. and Information Management Services Inc. (2018). SaTScan™
> User Guide. www.satscan.org.

To cite this R package:

``` r

citation("epidscan")
```

## License

MIT © Songyos Rajborirug

# Package index

## All functions

- [`NMlung_cas`](https://Songyosr.github.io/epidscan/reference/NMlung_cas.md)
  : New Mexico Lung Cancer Data (Case File)
- [`NMlung_geo`](https://Songyosr.github.io/epidscan/reference/NMlung_geo.md)
  : New Mexico Lung Cancer Data (Coordinates)
- [`NMlung_pop`](https://Songyosr.github.io/epidscan/reference/NMlung_pop.md)
  : New Mexico Lung Cancer Data (Population File)
- [`as.data.frame(`*`<satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/as.data.frame.satscan_result.md)
  : Convert SaTScan Results to Data Frame
- [`augment(`*`<satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/augment.satscan_result.md)
  : Augment SaTScan Results with Location-Level Data
- [`get_satscan_path()`](https://Songyosr.github.io/epidscan/reference/get_satscan_path.md)
  : Get SatScan Executable Path
- [`get_satscan_version()`](https://Songyosr.github.io/epidscan/reference/get_satscan_version.md)
  : Get SaTScan Version
- [`glance(`*`<satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/glance.satscan_result.md)
  : Glance at SaTScan Results
- [`is_ss_tbl()`](https://Songyosr.github.io/epidscan/reference/is_ss_tbl.md)
  : Check if Object is an ss_tbl
- [`map_clusters()`](https://Songyosr.github.io/epidscan/reference/map_clusters.md)
  : Interactive Map of SaTScan Clusters
- [`new_ss_tbl()`](https://Songyosr.github.io/epidscan/reference/new_ss_tbl.md)
  : Create a SaTScan Table
- [`print(`*`<satscan_prm>`*`)`](https://Songyosr.github.io/epidscan/reference/print.satscan_prm.md)
  : Print SaTScan Parameters
- [`print(`*`<satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/print.satscan_result.md)
  : Print SaTScan Results
- [`print(`*`<satscan_table>`*`)`](https://Songyosr.github.io/epidscan/reference/print.satscan_table.md)
  : Print Method for satscan_table
- [`print(`*`<summary.satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/print.summary.satscan_result.md)
  : Print Method for Summary of SaTScan Results
- [`prm_add()`](https://Songyosr.github.io/epidscan/reference/prm_add.md)
  : Add a New Parameter to PRM
- [`prm_defaults()`](https://Songyosr.github.io/epidscan/reference/prm_defaults.md)
  : Load Default PRM Parameters
- [`prm_options()`](https://Songyosr.github.io/epidscan/reference/prm_options.md)
  : Create SaTScan Parameter Object
- [`prm_parse()`](https://Songyosr.github.io/epidscan/reference/prm_parse.md)
  : Parse a SaTScan PRM Source
- [`prm_set()`](https://Songyosr.github.io/epidscan/reference/prm_set.md)
  : Modify PRM Parameters
- [`prm_summarize()`](https://Songyosr.github.io/epidscan/reference/prm_summarize.md)
  : Summarize Analysis Parameters
- [`prm_validate()`](https://Songyosr.github.io/epidscan/reference/prm_validate.md)
  : Validate PRM Parameters
- [`prm_write()`](https://Songyosr.github.io/epidscan/reference/prm_write.md)
  : Write PRM List to File
- [`read_prm()`](https://Songyosr.github.io/epidscan/reference/read_prm.md)
  : Read a SaTScan PRM File (Simple)
- [`satscanr()`](https://Songyosr.github.io/epidscan/reference/satscanr.md)
  : Run SaTScan Analysis
- [`set_satscan_path()`](https://Songyosr.github.io/epidscan/reference/set_satscan_path.md)
  : Set SatScan Executable Path
- [`ss_cas()`](https://Songyosr.github.io/epidscan/reference/ss_cas.md)
  : Coerce Data to SaTScan Case Table
- [`ss_ctl()`](https://Songyosr.github.io/epidscan/reference/ss_ctl.md)
  : Coerce Data to SaTScan Control Table
- [`ss_geo()`](https://Songyosr.github.io/epidscan/reference/ss_geo.md)
  : Coerce Data to SaTScan Coordinates Table
- [`ss_grd()`](https://Songyosr.github.io/epidscan/reference/ss_grd.md)
  : Coerce Data to SaTScan Grid Table
- [`ss_met()`](https://Songyosr.github.io/epidscan/reference/ss_met.md)
  : Coerce Data to SaTScan Meta Locations
- [`ss_nbr()`](https://Songyosr.github.io/epidscan/reference/ss_nbr.md)
  : Coerce Data to SaTScan Neighbors Table
- [`ss_nwk()`](https://Songyosr.github.io/epidscan/reference/ss_nwk.md)
  : Coerce Data to SaTScan Network Table
- [`ss_order()`](https://Songyosr.github.io/epidscan/reference/ss_order.md)
  : Get ss_tbl Column Order
- [`ss_pop()`](https://Songyosr.github.io/epidscan/reference/ss_pop.md)
  : Coerce Data to SaTScan Population Table
- [`ss_roles()`](https://Songyosr.github.io/epidscan/reference/ss_roles.md)
  : Get ss_tbl Roles
- [`ss_spec()`](https://Songyosr.github.io/epidscan/reference/ss_spec.md)
  : Get ss_tbl Specification
- [`ss_type()`](https://Songyosr.github.io/epidscan/reference/ss_type.md)
  : Get ss_tbl Type
- [`` `[`( ``*`<satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/sub-.satscan_result.md)
  : Extract Specific Clusters
- [`summary(`*`<satscan_prm>`*`)`](https://Songyosr.github.io/epidscan/reference/summary.satscan_prm.md)
  : Summary of SaTScan Parameters
- [`summary(`*`<satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/summary.satscan_result.md)
  : Enhanced Summary for SaTScan Results
- [`tidy(`*`<satscan_result>`*`)`](https://Songyosr.github.io/epidscan/reference/tidy.satscan_result.md)
  : Tidy SaTScan Results into a Data Frame
- [`write_satscan()`](https://Songyosr.github.io/epidscan/reference/write_satscan.md)
  : Write SaTScan File

# Articles

### All vignettes

- [Getting Started with
  epidscan](https://Songyosr.github.io/epidscan/articles/getting-started.md):
- [SaTScan Parameter
  Reference](https://Songyosr.github.io/epidscan/articles/satscan-parameters.md):
